# Qúa trình khởi tạo VM
## 1. Cách trình bày 1
![](https://github.com/khanhnt99/thuctap012017/raw/master/XuanSon/OpenStack/Nova/images/nova-quatrinhboot1.png)

![](https://github.com/khanhnt99/thuctap012017/raw/master/XuanSon/OpenStack/Nova/images/nova-quatrinhboot2.png)
- **Bước 1:** Horizon Dashboard hoặc Openstack CLI lấy thông tin đăng nhập và chứng thực của người dùng cùng với định danh service thông qua `REST API` để xác thực với **Keystone** sinh ra `token`.
- **Bước 2:** Sau khi xác thực thành công, client sẽ gửi request khởi chạy máy ảo tới `nova-api`.
- **Bước 3:** `nova service` xác thực lại thông qua token với `Keystone-api` và nhận được header với `role` và `permission`.
- **Bước 4:** `nova API` gửi lệnh tới `nova-conductor` kiểm tra trong database có conflicts hay không để tạo 1 entry mới.
- **Bước 5:** `nova-api` gửi `RPC` đến `nova-scheduler` service để lập lịch tạo máy ảo.
- **Bước 6:** `nova-scheduler` service chon request từ `message queue`.
- **Bước 7:** `nova-scheduler` chọn compute host sẽ chạy `VM` `(hay chọn nova-compute nào)`. Việc này thông qua `filters` và `weigths`.
- **Bước 8:** `nova-compute` service chọn request từ `message-queue`
- **Bước 9:** `nova-compute` service yêu cầu `nova-conductor` để tìm thông tin về instance. VD: Host ID, flavor...
- **Bước 10:** `nova-conductor` service phản hồi từ `queue`.
- **Bước 11:** `nova-conductor` service lấy thông tin về instance từ DB.
- **Bước 12:** `nova-compute` service lấy thông tin instance từ `queue`. Sử dụng `image` sử dụng cho instance. `nova-compute` yêu cầu `glance-api service` cung cấp URL.
- **Bước 13:** `Glance-api` xác thực token thông qua `Keystone` rồi return metadata của image bao gồm URL.
- **Bước 14:** `nova-compute` service chuyển token đến `neutron-api` và yêu cầu nó cấu hình network cho instance.
- **Bước 15:** `neutron` xác thực token qua **Keystone** và cấu hình IP và network.
- **Bước 16:** `nova-compute` tác động đến `cinder-api` để gắn volume đến các Instance.
- **Bước 17:** `nova-compute` sinh data cho Hypervisor và thực thi yêu cầu thông qua `libvirt`.

__Docs__
- https://github.com/khanhnt99/thuctap012017/blob/master/XuanSon/OpenStack/Nova/docs/Qu%C3%A1%20tr%C3%ACnh%20boot%20m%E1%BB%99t%20VM%20trong%20OpenStack.md
- https://github.com/lacoski/OpenStack-Note/blob/master/docs/nova/work-flow-launch-instance.md
- https://github.com/khanhnt99/Timhieu_Openstack/blob/master/Doc/03.%20Nova/4.%20flow-create-VM-nova.md