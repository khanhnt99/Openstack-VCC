# Install Octavia Openstack
## Prerequisites
- Tạo database octavia.
- Tạo user octavia.
- Gắn role admin cho user octavia.
- Tạo service loadbalancer.
- Tạo endpoint cho service loadbalancer.
- Tạo `octavia-openrc` file

    ```
    export OS_PROJECT_DOMAIN_NAME=Default
    export OS_USER_DOMAIN_NAME=Default
    export OS_PROJECT_NAME=service
    export OS_USERNAME=octavia
    export OS_PASSWORD=vccloud123
    export OS_AUTH_URL=http://khanhnt-controller:5000
    export OS_IDENTITY_API_VERSION=3
    export OS_IMAGE_API_VERSION=2
    export OS_VOLUME_API_VERSION=3
    ```
- Build image amphora
    + https://docs.openstack.org/octavia/latest/admin/amphora-image-build.html
    ```
    apt install python3-pip
    apt install python3-virtualenv
    virtualenv octavia_disk_image_create
    source octavia_disk_image_create/bin/activate
    cd octavia/diskimage-create
    pip install -r requirements.txt

    diskimage-create.sh -g stable/wallaby
    ```
- `openstack image create --disk-format qcow2 --container-format bare \
  --private --tag amphora \
  --file <path to the amphora image> amphora-x64-haproxy`
- `openstack flavor create --id 200 --vcpus 1 --ram 1024 \
  --disk 2 "amphora" --private`

## Install and configure components
- `apt install octavia-api octavia-health-manager octavia-housekeeping octavia-worker python3-octavia python3-octaviaclient`.
- Tạo certificate
```
git clone https://opendev.org/openstack/octavia.git
cd octavia/bin/
source create_dual_intermediate_CA.sh
mkdir -p /etc/octavia/certs/private
chmod 755 /etc/octavia -R
cp -p etc/octavia/certs/server_ca.cert.pem /etc/octavia/certs
cp -p etc/octavia/certs/server_ca-chain.cert.pem /etc/octavia/certs
cp -p etc/octavia/certs/server_ca.key.pem /etc/octavia/certs/private
cp -p etc/octavia/certs/client_ca.cert.pem /etc/octavia/certs
cp -p etc/octavia/certs/client.cert-and-key.pem /etc/octavia/certs/private
```
- Tạo security group 


- https://docs.openstack.org/octavia/latest/install/install-ubuntu.html
- https://docs.openstack.org/octavia/latest/admin/amphora-image-build.html
- https://leftasexercise.com/2020/05/01/openstack-octavia-architecture-and-installation/