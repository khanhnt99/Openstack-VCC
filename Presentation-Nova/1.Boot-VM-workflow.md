# Quá trình tạo 1 VM trong Openstack
![](https://github.com/khanhnt99/openstackbasic/raw/master/picture/nova-2.png)

- **B1:** Từ CLI, nhập thông tin chứng thực (ví dụ như username hoặc password), sau đó thực hiện lời gọi REST API đến Keystone để xác thực.
- **B2:** Keystone xác thực thông tin người dùng và tạo ra 1 `token` xác thực gửi trở lại cho người dùng, mục đích là để `xác thực` trong các bản tin `request` tới các dịch vụ khác thông qua REST.
- **B3:** CLI chuyển các yêu cầu tạo máy ảo mới thông qua thao tác `launch instance`, thao tác này thực hiện `REST API` request và gửi yêu cầu tới Nova-api.
- **B4:** **nova-api** nhận yêu cầu và hỏi lại Keystone xem `auth-token` mang theo yêu cầu tạo máy ảo của người sử dụng có hợp lệ không, nếu có thì hỏi quyền hạn truy cập của người dùng đó.
- **B5:** Keystone xác nhận token và update lại trong header xác thực `roles` và `quyền hạn truy cập` dịch vụ lại cho **nova-api**.
- **B6:** **nova-api** tương tác với **nova-database**.
- **B7:** Database tạo ra `entry` lưu thông tin máy ảo mới.
- **B8:** **nova-api** gửi `rpc.call` request tới **nova-scheduler** để cập nhật `entry` của máy ảo mới và yêu cầu `host ID` (ID của máy compute mà máy ảo sẽ được triển khai trên nó). (Yêu cầu này được lưu trong hàng đợi Message Broker - RabbitMQ).
- **B9:** **nova-scheduler** lấy yêu cầu từ hàng đợi.
- **B10:**  **nova-schduler** tương tác với **nova-database** để tìm host compute phù hợp thông qua việc sàng lọc theo cấu hình và yêu cầu cấu hình của máy ảo.
- **B11:** **nova-database** cập nhật lại entry của máy ảo mới với host ID phù hợp sau khi lọc.
- **B12:** **nova-scheduler** gửi `rpc.cast` request tới **nova-compute** mang theo yêu cầu tạo máy ảo với host phù hợp.
- **B13:** **nova-compute** lấy yêu cầu từ hàng đợi.
- **B14:** **nova-compute** gửi `rpc.call` request tới **nova-conductor** để lấy thông tin như host ID và flavor (Thông tin về RAM, CPU, disk) `(nova-compute lấy thông tin này từ database thông qua nova-conductor vì lí do bảo mật).
- **B15:** **nova-conductor** lấy yêu cầu từ hàng đợi.
- **B16:** **nova-conductor** tương tác với **nova-database**.
- **B17:** **nova-database** trả lại thông tin của máy ảo mới cho **nova-conductor**.
- **B18:** **nova-conductor** trả lại thông tin máy ảo vào hàng đợi, rồi **nova-compute** lấy thông tin máy ảo từ hàng đợi.
- **B19:** **nova-compute** thực hiện REST API bằng việc gửi `auth-token` tới glance-api để lấy image URL với `Image ID` và Upload Image từ image storage.
- **B20:** glance-api xác thực auth-token với Keystone.
- **B21:** **nova-compute** lất meta-data của image (Image type, image size).
- **B22:** **nova-compute** thực hiện REST API mang theo `auth-token` đến Network API để xin cấp phát IP và cấu hình mạng cho máy ảo.
- **B23:** Quantum-server (Neutron) xác thực auth-token với Keystone.
- **B24:** **nova-compute** lấy thông tin về network.
- **B25:** **nova-compute** thực hiện REST call mang theo auth-token tới Volume API để yêu cầu volumes gắn máy ảo.
- **B26:** cinder-api xác thực auth-token với Keystone.
- **B27:** **nova-compute** lấy thông tin block-storage cấp cho máy ảo.
- **B28:** **nova-compute** tạo dữ liệu cho hypervisor driver và thực thi yêu cầu tạo máy ảo trên Hypervisor `(thông qua libvirt hoặc các thư viện khác tương tác với Hypervisor).
